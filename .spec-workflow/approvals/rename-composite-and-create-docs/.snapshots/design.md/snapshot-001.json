{
  "id": "snapshot_1771866107199_klv2u6qs8",
  "approvalId": "approval_1771866107190_jsulxj834",
  "approvalTitle": "Design: ディレクトリリネーム・3層ドキュメント構造",
  "version": 1,
  "timestamp": "2026-02-23T17:01:47.199Z",
  "trigger": "initial",
  "status": "pending",
  "content": "# Design Document\n\n## Overview\n\n`.github/composite/` → `.github/actions/` へのディレクトリリネームと、Reusable Workflows / Composite Actions のドキュメント体系を構築する。ドキュメントは3層構造（ルート README → 一覧 README → 個別詳細ドキュメント）とし、情報の参照性と保守性を両立する。\n\n## Architecture\n\n### ドキュメント3層構造\n\n```\nREADME.md（ルート）\n├── 概要 + 参照リンク\n├── → .github/workflows/README.md\n├── → .github/actions/README.md\n└── Development / Security Policy 等（既存セクション維持）\n\n.github/workflows/README.md（一覧）\n├── Reusable Workflows 一覧（簡単な説明 + 詳細リンク）\n├── Internal CI Workflows 一覧（簡単な説明）\n└── → docs/*.md\n\n.github/actions/README.md（一覧）\n├── Composite Actions 一覧（簡単な説明 + 詳細リンク）\n└── → docs/*.md\n\n.github/workflows/docs/*.md（個別詳細）\n.github/actions/docs/*.md（個別詳細）\n```\n\n### リネーム後のディレクトリ構造\n\n```\n.github/\n├── actions/                          # ← .github/composite/ からリネーム\n│   ├── README.md                     # 新規: Composite Actions 一覧\n│   ├── docs/                         # 新規: 詳細ドキュメント\n│   │   ├── pnpm-setup.md\n│   │   ├── playwright-setup.md\n│   │   ├── slack-notify-success.md\n│   │   └── slack-notify-failure.md\n│   ├── pnpm-setup/action.yml\n│   ├── playwright-setup/action.yml\n│   ├── slack-notify-success/action.yml\n│   └── slack-notify-failure/action.yml\n├── workflows/\n│   ├── README.md                     # 新規: Workflows 一覧 + Internal CI 説明\n│   ├── docs/                         # 新規: 詳細ドキュメント\n│   │   ├── actions-lint.md\n│   │   ├── auto-assign-pr.md\n│   │   ├── codeql-analysis.md\n│   │   └── tagpr-release.md\n│   ├── actions-lint.yml\n│   ├── auto-assign-pr.yml\n│   ├── codeql-analysis.yml\n│   ├── tagpr-release.yml\n│   ├── my-test.yml\n│   ├── my-setup-pr.yml\n│   ├── my-release.yml\n│   └── my-codeql.yml\n└── ...\n```\n\n## Components and Interfaces\n\n### Component 1: ディレクトリリネーム\n\n- **Purpose:** `.github/composite/` を `.github/actions/` にリネームし、全参照を更新\n- **操作:**\n  1. `git mv .github/composite .github/actions`\n  2. 以下のファイル内の参照を `.github/composite` → `.github/actions` に一括置換:\n     - `.ls-lint.yml`\n     - `CLAUDE.md`\n     - `README.md`\n     - `docs/adr/004-composite-actions-support.md`\n  3. Serena memories の更新（`codebase_structure`, `style_and_conventions`, `task_completion_checklist`）\n\n### Component 2: `.github/workflows/README.md`（一覧）\n\n- **Purpose:** Reusable Workflows と Internal CI Workflows の一覧ページ\n- **構造:**\n\n```markdown\n# Workflows\n\n## Reusable Workflows\n\n| ワークフロー | 説明 |\n|---|---|\n| [actions-lint](docs/actions-lint.md) | GitHub Actions の品質ゲート |\n| [auto-assign-pr](docs/auto-assign-pr.md) | PR 作成者の自動 assignee 設定 |\n| [codeql-analysis](docs/codeql-analysis.md) | CodeQL セキュリティスキャン |\n| [tagpr-release](docs/tagpr-release.md) | tagpr リリース管理 |\n\n## 使い方\n\n{簡潔な uses: の書式説明}\n\n## Internal CI Workflows\n\n| ワークフロー | トリガー | 呼び出し先 | 説明 |\n|---|---|---|---|\n| my-test.yml | PR, merge_group | actions-lint.yml | 品質ゲート |\n| my-setup-pr.yml | PR opened | auto-assign-pr.yml | 自動 assignee |\n| my-release.yml | push (main) | tagpr-release.yml | リリース管理 |\n| my-codeql.yml | PR, push, merge_group | codeql-analysis.yml | セキュリティスキャン |\n```\n\n### Component 3: `.github/actions/README.md`（一覧）\n\n- **Purpose:** Composite Actions の一覧ページ\n- **構造:**\n\n```markdown\n# Actions\n\n## Composite Actions\n\n| アクション | 説明 |\n|---|---|\n| [pnpm-setup](docs/pnpm-setup.md) | Node.js + pnpm セットアップ |\n| [playwright-setup](docs/playwright-setup.md) | Playwright ブラウザセットアップ |\n| [slack-notify-success](docs/slack-notify-success.md) | Slack 成功通知 |\n| [slack-notify-failure](docs/slack-notify-failure.md) | Slack 失敗通知 |\n\n## 使い方\n\n{簡潔な uses: の書式説明}\n```\n\n### Component 4: Reusable Workflow 詳細ドキュメント（4ファイル）\n\n- **Purpose:** 各 Reusable Workflow の詳細リファレンス\n- **共通構造:**\n\n```markdown\n# {workflow-name}\n\n{概要説明}\n\n## トリガー\n\n`workflow_call`\n\n## Inputs\n\n| 入力名 | 型 | 必須 | デフォルト値 | 説明 |\n|---|---|---|---|---|\n\n## Secrets（該当する場合）\n\n| シークレット名 | 必須 | 説明 |\n|---|---|---|\n\n## Outputs（該当する場合）\n\n| 出力名 | 説明 |\n|---|---|\n\n## Permissions\n\n{必要な permissions の表}\n\n## 前提条件\n\n{前提条件の箇条書き}\n\n## 使用例\n\n{YAML コードブロック}\n```\n\n### Component 5: Composite Action 詳細ドキュメント（4ファイル）\n\n- **Purpose:** 各 Composite Action の詳細リファレンス\n- **共通構造:**\n\n```markdown\n# {action-name}\n\n{概要説明}\n\n## Inputs\n\n| 入力名 | 必須 | デフォルト値 | 説明 |\n|---|---|---|---|\n\n## 前提条件\n\n{前提条件の箇条書き}\n\n## 使用例\n\n{YAML コードブロック}\n```\n\n### Component 6: ルート `README.md` のリファクタリング\n\n- **Purpose:** 詳細情報を各一覧 README に委譲し、簡潔なトップページにする\n- **削除対象:** `Available Workflows` セクション内の:\n  - Reusable Workflows の詳細（inputs テーブル、コード例）\n  - Composite Actions の詳細（inputs テーブル、コード例）\n  - Internal CI Workflows テーブル\n- **追加内容:** 各一覧 README への参照リンク\n- **維持するセクション:** Overview, Usage（簡潔な形式説明のみ）, Development, Workflow Security Policy, Manual Setup Required\n\n## 参照更新の全一覧\n\n### `.github/composite` → `.github/actions` の文字列置換が必要なファイル\n\n| ファイル | 更新箇所 |\n|---|---|\n| `.ls-lint.yml` | `.github/composite:` → `.github/actions:` |\n| `CLAUDE.md` | 3箇所（ディレクトリ構成、使い分け、actionlint非互換）|\n| `README.md` | 使用例の `uses:` パス（複数箇所）|\n| `docs/adr/004-composite-actions-support.md` | 決定事項・結果の記述（複数箇所）|\n| `.serena/memories/codebase_structure` | ディレクトリ構造説明 |\n| `.serena/memories/style_and_conventions` | ファイル配置ルール |\n| `.serena/memories/task_completion_checklist` | Composite Actions 配置ルール |\n\n## actionlint との互換性\n\nactionlint は `.github/workflows/` ディレクトリのみをスキャン対象とする。`.github/actions/` は `.github/workflows/` の外にあるため、`composite/` と同様に自然に無視される。追加設定は不要。\n\n## Testing Strategy\n\n### CI 整合性確認\n\n- `ls-lint` が `.github/actions/` 配下の命名規則を正しく検証すること（`.ls-lint.yml` の更新後）\n- `ghalint run-action` が `.github/actions/` 配下の `action.yml` をスキャンすること\n- `actionlint` が `.github/actions/` を無視すること\n\n### ドキュメントリンク整合性\n\n- 各一覧 README 内のリンクが正しい詳細ドキュメントを指していること\n- ルート README 内のリンクが正しい一覧 README を指していること\n- 使用例の `uses:` パスが `.github/actions/` を使用していること\n",
  "fileStats": {
    "size": 7823,
    "lines": 238,
    "lastModified": "2026-02-23T17:01:42.005Z"
  },
  "comments": []
}