{
  "id": "snapshot_1771668890905_pj0fbhw5l",
  "approvalId": "approval_1771668834633_708wg4q6j",
  "approvalTitle": "Design: composite-actions-creation",
  "version": 2,
  "timestamp": "2026-02-21T10:14:50.905Z",
  "trigger": "approved",
  "status": "pending",
  "content": "# Design Document\n\n## Overview\n\n本ドキュメントは、`kryota-dev/actions` リポジトリに **4つの Composite Actions** を実装するための技術設計を定義する。\n\n実装対象の Composite Actions:\n\n| Action名 | 格納パス | 用途 |\n|---|---|---|\n| `pnpm-setup` | `.github/composite/pnpm-setup/action.yml` | Node.js・pnpm セットアップ（ストアキャッシュ付き） |\n| `playwright-setup` | `.github/composite/playwright-setup/action.yml` | Playwright ブラウザのキャッシュ付きインストール |\n| `slack-notify-success` | `.github/composite/slack-notify-success/action.yml` | 成功通知（Bot OAuth Token + chat.postMessage API） |\n| `slack-notify-failure` | `.github/composite/slack-notify-failure/action.yml` | 失敗通知（Incoming Webhook URL 方式） |\n\n加えて、以下のドキュメント更新を行う:\n- `README.md`: 各 Action の使用方法・入力パラメータ一覧を `### Composite Actions` セクションに追記\n- `.github/composite/.gitkeep`: 実際の Action 追加に伴い削除\n\n## Steering Document Alignment\n\n### 技術基準\n\n- `uses:` は full commit SHA（40文字）でピン留め（`ghalint run-action` / `zizmor` で CI 検証）\n- SHA のコメントにはタグ名を記載（例: `# v4.1.0`）\n- Renovate Bot により SHA を自動更新（`renovate.json5` の `helpers:pinGitHubActionDigests` により `.github/composite/` 配下の `action.yml` も自動対象）\n- `inputs` の値を `run` ステップへ直接埋め込まず、`env:` 経由で環境変数として渡す（テンプレートインジェクション対策）\n- `run` ステップには必ず `shell: bash` を明記\n\n### プロジェクト構造規約\n\n- Composite Actions は `.github/composite/` 配下に配置（actionlint の誤検知を回避）\n- ディレクトリ名は kebab-case（ls-lint で強制: `.dir: kebab-case`）\n- ファイル名は `action.yml` のみ許可（ls-lint で強制: `.yml: regex:action`）\n\n## Code Reuse Analysis\n\n### 既存コンポーネントの活用\n\n| コンポーネント | 活用方法 |\n|---|---|\n| `aqua.yaml` の `ghalint@v1.5.5` | `ghalint run-action` は v1.5.1 以降でサポート済み。追加設定不要 |\n| `my-test.yml` の `ghalint run-action` ステップ | 既存ステップが `.github/composite/` 配下の `action.yml` を自動検証する |\n| `renovate.json5` の `helpers:pinGitHubActionDigests` | `.github/composite/` 配下の `action.yml` 内の `uses:` も追加設定不要で自動更新対象 |\n| `uvx zizmor --format=github .` | リポジトリルート指定のため `.github/composite/` 配下も自動スキャン対象 |\n| `.ls-lint.yml` の `.github/composite` ルール | kebab-case ディレクトリ名と `action.yml` ファイル名を既に強制中 |\n\n### 変更が必要なファイル\n\n| ファイル | 変更種別 | 変更内容 |\n|---|---|---|\n| `.github/composite/pnpm-setup/action.yml` | 新規作成 | pnpm-setup Composite Action |\n| `.github/composite/playwright-setup/action.yml` | 新規作成 | playwright-setup Composite Action |\n| `.github/composite/slack-notify-success/action.yml` | 新規作成 | slack-notify-success Composite Action |\n| `.github/composite/slack-notify-failure/action.yml` | 新規作成 | slack-notify-failure Composite Action |\n| `.github/composite/.gitkeep` | 削除 | 実際の Action 追加後は不要 |\n| `README.md` | 修正 | `### Composite Actions` セクションに各 Action の詳細を追記 |\n\n## Architecture\n\n### ディレクトリ構造（To-Be）\n\n```\n.github/\n  composite/\n    pnpm-setup/\n      action.yml          # Node.js・pnpm セットアップ\n    playwright-setup/\n      action.yml          # Playwright ブラウザキャッシュ付きインストール\n    slack-notify-success/\n      action.yml          # Slack 成功通知（Bot OAuth Token）\n    slack-notify-failure/\n      action.yml          # Slack 失敗通知（Incoming Webhook）\n    .gitkeep              # 削除（Action 追加後は不要）\n  workflows/\n    my-test.yml           # 変更なし（ghalint run-action は既存済み）\n    my-setup-pr.yml       # 変更なし\n    my-release.yml        # 変更なし\n    my-codeql.yml         # 変更なし\nREADME.md                 # 変更: Composite Actions セクション更新\n```\n\n### Action 間の依存関係\n\n```mermaid\ngraph TD\n    subgraph Setup[\"セットアップ系\"]\n        PS[\"pnpm-setup<br/>.github/composite/pnpm-setup\"]\n        PW[\"playwright-setup<br/>.github/composite/playwright-setup\"]\n    end\n\n    subgraph Notify[\"通知系\"]\n        SU[\"slack-notify-success<br/>.github/composite/slack-notify-success\"]\n        SF[\"slack-notify-failure<br/>.github/composite/slack-notify-failure\"]\n    end\n\n    subgraph ExternalActions[\"外部 Actions（uses:）\"]\n        PA[\"pnpm/action-setup@v4.1.0\"]\n        SN[\"actions/setup-node@v4.4.0\"]\n        CA[\"actions/cache@v4.2.3\"]\n    end\n\n    PS --> PA\n    PS --> SN\n    PS --> CA\n    PW --> CA\n    PW -.->|\"前提条件（直接依存なし）\"| PS\n\n    SU -->|\"curl via env\"| SlackAPI[\"Slack chat.postMessage API\"]\n    SF -->|\"curl via env\"| SlackWH[\"Slack Incoming Webhook\"]\n```\n\n### CI パイプラインとの関係\n\n```mermaid\ngraph LR\n    PR[\"PR 作成・更新\"]\n    PR --> LS[\"ls-lint<br/>kebab-case / regex:action 検証\"]\n    PR --> GA[\"ghalint run-action<br/>SHA ピン留め検証\"]\n    PR --> ZI[\"zizmor<br/>テンプレートインジェクション等\"]\n\n    LS --> Actions[\".github/composite/*/action.yml\"]\n    GA --> Actions\n    ZI --> Actions\n```\n\n## Components and Interfaces\n\n### Component 1: pnpm-setup\n\n- **Purpose:** Node.js と pnpm のセットアップ、pnpm ストアキャッシュ、依存関係インストールを一括実行する\n- **Inputs:** なし（リポジトリルートの `.node-version`・`package.json`・`pnpm-lock.yaml` を参照）\n- **Outputs:** なし\n- **Dependencies:**\n  - `pnpm/action-setup@a7487c7e89a18df4991f7f222e4898a00d66ddda` (v4.1.0)\n  - `actions/setup-node@49933ea5288caeca8642d1e84afbd3f7d6820020` (v4.4.0)\n  - `actions/cache@5a3ec84eff668545956fd18022155c47e93e2684` (v4.2.3)\n- **設計判断:** inputs を設けないシンプルな設計とする。`package_json_file`・`.node-version`・`pnpm-lock.yaml` のパスカスタマイズは過度な汎用化になるため現時点では対象外とする\n\n**ステップ構成:**\n\n1. `pnpm/action-setup` で pnpm インストール（`run_install: false`）\n2. `actions/setup-node` で Node.js インストール（`node-version-file: .node-version`、`cache: 'pnpm'`）\n3. `run` で `pnpm store path --silent` を取得して `$GITHUB_ENV` の `STORE_PATH` に設定\n4. `actions/cache` で pnpm ストアをキャッシュ（キー: `{runner.os}-pnpm-store-{hash(pnpm-lock.yaml)}`）\n5. `run` で `pnpm install` 実行\n\n---\n\n### Component 2: playwright-setup\n\n- **Purpose:** Playwright ブラウザをキャッシュ付きでインストールし、CI の実行時間を短縮する\n- **Inputs:** なし\n- **Outputs:** なし（内部ステップ出力 `version` は `$GITHUB_OUTPUT` 経由で `actions/cache` の key に使用）\n- **Dependencies:**\n  - `actions/cache@5a3ec84eff668545956fd18022155c47e93e2684` (v4.2.3)\n- **前提条件:** 呼び出し前に `pnpm-setup`（または同等）が完了していること\n- **設計判断:** `actions/cache` のキャッシュヒット時は `pnpm exec playwright install --with-deps` をスキップするため、明示的な `if: steps.cache-playwright.outputs.cache-hit != 'true'` 条件をインストールステップに付与する\n\n**ステップ構成:**\n\n1. `run` で `pnpm exec playwright --version` を実行し、`sed` でバージョン番号のみを抽出して `$GITHUB_OUTPUT` に `version` として書き出す（`id: playwright-version`）\n2. `actions/cache` でブラウザキャッシュ（パス: `~/.cache/ms-playwright`、キー: `{runner.os}-playwright-{steps.playwright-version.outputs.version}`）（`id: cache-playwright`）\n3. `run` で `pnpm exec playwright install --with-deps` を実行（`if: steps.cache-playwright.outputs.cache-hit != 'true'`）\n\n---\n\n### Component 3: slack-notify-success\n\n- **Purpose:** ワークフロー成功時に Slack の `chat.postMessage` API（Bot OAuth Token 認証）へ通知を送信する\n- **Inputs:** `channel-id`（必須）、`bot-oauth-token`（必須）、`color`（任意）、`mention-user`（任意）、`title`（任意）、`message`（任意）、`thread-ts`（任意）、`reply-broadcast`（任意）\n- **Outputs:** なし\n- **Dependencies:** 外部 Action なし（`curl` のみ使用）\n- **設計判断:**\n  - 全入力値および `runner.debug` を `env:` 経由で渡してテンプレートインジェクションを回避する（`runner.debug` はユーザー入力ではないが、ポリシーの一貫性のため `RUNNER_DEBUG` 環境変数として渡す）\n  - `thread_ts` は文字列 `'null'` をデフォルト値とし、シェルスクリプト内で `if [ \"${SLACK_THREAD_TS}\" != 'null' ]` により条件分岐する\n  - `curl --max-time 30` でタイムアウトを設定し、`|| { echo \"::error::...\"; exit 1; }` でエラーハンドリングする\n\n**ステップ構成:**\n\n1. `run` ステップ（`id: post-message-success`）:\n   - `env:` で全 inputs および `runner.debug`（`RUNNER_DEBUG`）を環境変数にマップ\n   - `RUNNER_DEBUG == '1'` のとき `set -x` を実行\n   - `mention-user` の有無でタイトル文字列を分岐\n   - `thread_ts != 'null'` のとき JSON に `\"thread_ts\"` フィールドを追加（シェルの `if` 文で動的生成）\n   - `curl` で `https://slack.com/api/chat.postMessage` へ POST\n\n---\n\n### Component 4: slack-notify-failure\n\n- **Purpose:** ワークフロー失敗時に Slack の Incoming Webhook URL へ通知を送信する\n- **Inputs:** `webhook-url`（必須）、`color`（任意）、`mention-user`（任意）、`title`（任意）、`message`（任意）\n- **Outputs:** なし\n- **Dependencies:** 外部 Action なし（`curl` のみ使用）\n- **設計判断:**\n  - `slack-notify-success` との違い: チャンネル指定不要、Bot OAuth Token の代わりに Webhook URL を使用、`thread_ts` / `reply-broadcast` は Incoming Webhook でサポートされないため inputs に含めない\n  - 全入力値および `runner.debug` を `env:` 経由で渡してテンプレートインジェクションを回避する（`RUNNER_DEBUG` 環境変数として渡す）\n  - `curl --max-time 30` でタイムアウトを設定し、`|| { echo \"::error::...\"; exit 1; }` でエラーハンドリングする\n\n**ステップ構成:**\n\n1. `run` ステップ（`id: post-message-failure`）:\n   - `env:` で全 inputs および `runner.debug`（`RUNNER_DEBUG`）を環境変数にマップ\n   - `RUNNER_DEBUG == '1'` のとき `set -x` を実行\n   - `mention-user` の有無でタイトル文字列を分岐\n   - `curl` で Incoming Webhook URL へ POST\n\n## Data Models\n\n### pnpm-setup / action.yml\n\n```yaml\nname: Setup pnpm\ndescription: Setup Node.js and pnpm, and install dependencies\n\nruns:\n  using: 'composite'\n  steps:\n    - uses: pnpm/action-setup@a7487c7e89a18df4991f7f222e4898a00d66ddda # v4.1.0\n      name: Install pnpm\n      with:\n        package_json_file: package.json\n        run_install: false\n\n    - name: Install Node.js\n      uses: actions/setup-node@49933ea5288caeca8642d1e84afbd3f7d6820020 # v4.4.0\n      with:\n        node-version-file: .node-version\n        cache: 'pnpm'\n\n    - name: Get pnpm store directory\n      shell: bash\n      run: |\n        echo \"STORE_PATH=$(pnpm store path --silent)\" >> \"$GITHUB_ENV\"\n\n    - uses: actions/cache@5a3ec84eff668545956fd18022155c47e93e2684 # v4.2.3\n      name: Setup pnpm cache\n      with:\n        path: ${{ env.STORE_PATH }}\n        key: ${{ runner.os }}-pnpm-store-${{ hashFiles('**/pnpm-lock.yaml') }}\n        restore-keys: |\n          ${{ runner.os }}-pnpm-store-\n\n    - name: Install dependencies\n      shell: bash\n      run: pnpm install\n```\n\n### playwright-setup / action.yml\n\n```yaml\nname: Setup Playwright\ndescription: Setup Playwright browsers with caching\n\nruns:\n  using: 'composite'\n  steps:\n    - name: Get Playwright version\n      id: playwright-version\n      shell: bash\n      run: |\n        PLAYWRIGHT_VERSION=$(pnpm exec playwright --version | sed 's/Version //')\n        echo \"version=$PLAYWRIGHT_VERSION\" >> \"$GITHUB_OUTPUT\"\n\n    - name: Cache Playwright browsers\n      id: cache-playwright\n      uses: actions/cache@5a3ec84eff668545956fd18022155c47e93e2684 # v4.2.3\n      with:\n        path: ~/.cache/ms-playwright\n        key: ${{ runner.os }}-playwright-${{ steps.playwright-version.outputs.version }}\n\n    - name: Install Playwright browsers\n      if: steps.cache-playwright.outputs.cache-hit != 'true'\n      shell: bash\n      run: pnpm exec playwright install --with-deps\n```\n\n### slack-notify-success / action.yml\n\n```yaml\nname: Post Message to Slack - Success\ndescription: Post a message to Slack when the workflow succeeds\n\ninputs:\n  channel-id:\n    description: Slack Channel ID\n    required: true\n  bot-oauth-token:\n    description: Slack Bot OAuth Token\n    required: true\n  color:\n    description: Color of the message\n    required: false\n    default: good\n  mention-user:\n    description: Mention user\n    required: false\n    default: ''\n  title:\n    description: Message title\n    required: false\n    default: 'workflow execution completed'\n  message:\n    description: Message body\n    required: false\n    default: 'Execution log: ${{ github.server_url }}/${{ github.repository }}/actions/runs/${{ github.run_id }}'\n  thread-ts:\n    description: Thread timestamp for reply\n    required: false\n    default: 'null'\n  reply-broadcast:\n    description: Whether to broadcast the reply to the channel\n    required: false\n    default: 'false'\n\nruns:\n  using: 'composite'\n  steps:\n    - id: post-message-success\n      shell: bash\n      env:\n        SLACK_CHANNEL_ID: ${{ inputs.channel-id }}\n        SLACK_BOT_OAUTH_TOKEN: ${{ inputs.bot-oauth-token }}\n        SLACK_COLOR: ${{ inputs.color }}\n        SLACK_MENTION_USER: ${{ inputs.mention-user }}\n        SLACK_TITLE_TEXT: ${{ inputs.title }}\n        SLACK_MESSAGE: ${{ inputs.message }}\n        SLACK_THREAD_TS: ${{ inputs.thread-ts }}\n        SLACK_REPLY_BROADCAST: ${{ inputs.reply-broadcast }}\n        RUNNER_DEBUG: ${{ runner.debug }}\n      run: |\n        if [ \"${RUNNER_DEBUG}\" == \"1\" ]; then\n          set -x\n        fi\n        if [ -n \"${SLACK_MENTION_USER}\" ]; then\n          SLACK_TITLE=\"*SUCCESS - ${SLACK_MENTION_USER} ${SLACK_TITLE_TEXT}*\"\n        else\n          SLACK_TITLE=\"*SUCCESS - ${SLACK_TITLE_TEXT}*\"\n        fi\n        SLACK_DATA=$(cat <<EOF\n        {\n        $(if [ \"${SLACK_THREAD_TS}\" != 'null' ]; then\n          echo \"  \\\"thread_ts\\\": \\\"${SLACK_THREAD_TS}\\\",\"\n          if [ \"${SLACK_REPLY_BROADCAST}\" == 'true' ]; then\n            echo \"  \\\"reply_broadcast\\\": true,\"\n          fi\n        fi)\n          \"channel\": \"${SLACK_CHANNEL_ID}\",\n          \"attachments\": [\n            {\n              \"fallback\": \"${SLACK_TITLE}\",\n              \"pretext\": \"${SLACK_TITLE}\",\n              \"color\": \"${SLACK_COLOR}\",\n              \"author_name\": \"${GITHUB_REPOSITORY#${GITHUB_REPOSITORY_OWNER}/}\",\n              \"author_link\": \"${GITHUB_SERVER_URL}/${GITHUB_REPOSITORY}\",\n              \"text\": \"${SLACK_MESSAGE}\"\n            }\n          ]\n        }\n        EOF\n        )\n        curl --max-time 30 -X POST \\\n          -H \"Content-Type: application/json\" \\\n          -H \"Authorization: Bearer ${SLACK_BOT_OAUTH_TOKEN}\" \\\n          -d \"${SLACK_DATA}\" \\\n          \"https://slack.com/api/chat.postMessage\" \\\n          || { echo \"::error::Failed to post message to Slack\"; exit 1; }\n```\n\n### slack-notify-failure / action.yml\n\n```yaml\nname: Post Message to Slack - Failure\ndescription: Post a message to Slack when the workflow fails\n\ninputs:\n  webhook-url:\n    description: Slack Incoming Webhook URL\n    required: true\n  color:\n    description: Color of the message\n    required: false\n    default: danger\n  mention-user:\n    description: Mention user\n    required: false\n    default: ''\n  title:\n    description: Message title\n    required: false\n    default: 'workflow failed'\n  message:\n    description: Message body\n    required: false\n    default: 'Execution log: ${{ github.server_url }}/${{ github.repository }}/actions/runs/${{ github.run_id }}'\n\nruns:\n  using: 'composite'\n  steps:\n    - id: post-message-failure\n      shell: bash\n      env:\n        SLACK_WEBHOOK_URL: ${{ inputs.webhook-url }}\n        SLACK_COLOR: ${{ inputs.color }}\n        SLACK_MENTION_USER: ${{ inputs.mention-user }}\n        SLACK_TITLE_TEXT: ${{ inputs.title }}\n        SLACK_MESSAGE: ${{ inputs.message }}\n        RUNNER_DEBUG: ${{ runner.debug }}\n      run: |\n        if [ \"${RUNNER_DEBUG}\" == \"1\" ]; then\n          set -x\n        fi\n        if [ -n \"${SLACK_MENTION_USER}\" ]; then\n          SLACK_TITLE=\"*FAILURE - ${SLACK_MENTION_USER} ${SLACK_TITLE_TEXT}*\"\n        else\n          SLACK_TITLE=\"*FAILURE - ${SLACK_TITLE_TEXT}*\"\n        fi\n        SLACK_DATA=$(cat <<EOF\n        {\n          \"attachments\": [\n            {\n              \"fallback\": \"${SLACK_TITLE}\",\n              \"pretext\": \"${SLACK_TITLE}\",\n              \"color\": \"${SLACK_COLOR}\",\n              \"author_name\": \"${GITHUB_REPOSITORY#${GITHUB_REPOSITORY_OWNER}/}\",\n              \"author_link\": \"${GITHUB_SERVER_URL}/${GITHUB_REPOSITORY}\",\n              \"text\": \"${SLACK_MESSAGE}\"\n            }\n          ]\n        }\n        EOF\n        )\n        curl --max-time 30 -X POST \\\n          -H \"Content-Type: application/json\" \\\n          -d \"${SLACK_DATA}\" \\\n          \"${SLACK_WEBHOOK_URL}\" \\\n          || { echo \"::error::Failed to post message to Slack\"; exit 1; }\n```\n\n### README.md の `### Composite Actions` セクション（更新後）\n\n```markdown\n### Composite Actions\n\n#### pnpm-setup\n\nNode.js と pnpm のセットアップ、pnpm ストアキャッシュ、依存関係インストールを一括実行します。\n\n**前提条件:** リポジトリルートに `.node-version`・`package.json`・`pnpm-lock.yaml` が存在すること\n\n```yaml\nsteps:\n  - uses: kryota-dev/actions/.github/composite/pnpm-setup@v1\n```\n\n---\n\n#### playwright-setup\n\nPlaywright ブラウザをキャッシュ付きでインストールします。キャッシュヒット時はダウンロードをスキップします。\n\n**前提条件:** `pnpm-setup` Action（または同等のセットアップ）が先に完了していること\n\n```yaml\nsteps:\n  - uses: kryota-dev/actions/.github/composite/pnpm-setup@v1\n  - uses: kryota-dev/actions/.github/composite/playwright-setup@v1\n```\n\n---\n\n#### slack-notify-success\n\nワークフロー成功時に Slack へ通知します。Slack Bot OAuth Token と `chat.postMessage` API を使用します。\n\n| 入力名 | 必須 | デフォルト値 | 説明 |\n|---|---|---|---|\n| `channel-id` | 必須 | - | Slack チャンネル ID |\n| `bot-oauth-token` | 必須 | - | Slack Bot OAuth Token |\n| `color` | 任意 | `good` | メッセージのカラーバー色 |\n| `mention-user` | 任意 | `''` | メンション対象ユーザー |\n| `title` | 任意 | `workflow execution completed` | メッセージタイトル |\n| `message` | 任意 | 実行ログ URL | メッセージ本文 |\n| `thread-ts` | 任意 | `'null'` | スレッド返信先 timestamp |\n| `reply-broadcast` | 任意 | `'false'` | スレッド返信をチャンネルにもブロードキャストするか |\n\n```yaml\nsteps:\n  - uses: kryota-dev/actions/.github/composite/slack-notify-success@v1\n    with:\n      channel-id: ${{ vars.SLACK_CHANNEL_ID }}\n      bot-oauth-token: ${{ secrets.SLACK_BOT_OAUTH_TOKEN }}\n```\n\n---\n\n#### slack-notify-failure\n\nワークフロー失敗時に Slack へ通知します。Slack Incoming Webhook URL を使用します（`slack-notify-success` と異なり、チャンネル指定不要）。\n\n| 入力名 | 必須 | デフォルト値 | 説明 |\n|---|---|---|---|\n| `webhook-url` | 必須 | - | Slack Incoming Webhook URL |\n| `color` | 任意 | `danger` | メッセージのカラーバー色 |\n| `mention-user` | 任意 | `''` | メンション対象ユーザー |\n| `title` | 任意 | `workflow failed` | メッセージタイトル |\n| `message` | 任意 | 実行ログ URL | メッセージ本文 |\n\n```yaml\nsteps:\n  - uses: kryota-dev/actions/.github/composite/slack-notify-failure@v1\n    with:\n      webhook-url: ${{ secrets.SLACK_WEBHOOK_URL }}\n```\n```\n\n## Error Handling\n\n### エラーシナリオ\n\n1. **ls-lint: ディレクトリ名が kebab-case でない**\n   - **検出:** CI の ls-lint ステップがエラーを報告\n   - **対処:** ディレクトリ名を kebab-case に修正（例: `pnpmSetup` → `pnpm-setup`）\n\n2. **ghalint run-action: `uses:` がミュータブルタグ**\n   - **検出:** CI の `ghalint run-action` ステップがエラーを報告\n   - **対処:** `uses:` を full commit SHA + コメント形式に変更（例: `uses: actions/cache@5a3ec84eff668545956fd18022155c47e93e2684 # v4.2.3`）\n\n3. **zizmor: テンプレートインジェクション検出**\n   - **検出:** CI の zizmor ステップがエラーを報告\n   - **対処:** `${{ inputs.xxx }}` を直接 `run:` に埋め込まず、`env:` キー経由で環境変数として渡す\n\n4. **Slack API: `curl` リクエスト失敗**\n   - **検出:** `curl` の終了コードが非ゼロ\n   - **対処:** `|| { echo \"::error::Failed to post message to Slack\"; exit 1; }` により明示的にステップを失敗させる。`--max-time 30` によりタイムアウトでもエラーとなる\n\n5. **playwright-setup: `pnpm exec playwright --version` の出力フォーマット変化**\n   - **検出:** `sed 's/Version //'` が期待通りにバージョン番号を抽出できない\n   - **対処:** キャッシュキーが空になることでキャッシュがスキップされ、毎回インストールが実行される（機能は維持される）。Playwright のバージョン出力フォーマット変化時は `sed` パターンを更新する\n\n## Testing Strategy\n\n本機能は GitHub Actions の Composite Actions 実装であるため、従来的な Unit / Integration / E2E テストではなく、以下のアプローチで品質を保証する。\n\n### CI による自動検証（主要テスト手段）\n\nPR 作成時に `my-test.yml` が以下を自動検証する:\n\n| ステップ | 検証内容 |\n|---|---|\n| ls-lint | `.github/composite/` 配下のディレクトリ名が kebab-case、ファイル名が `action.yml` であること |\n| ghalint run-action | 各 `action.yml` 内の `uses:` が full commit SHA でピン留めされていること |\n| zizmor | 各 `action.yml` にテンプレートインジェクション等のセキュリティ問題がないこと |\n\n### 手動検証項目\n\n実装後に以下を手動で確認する:\n\n1. **pnpm-setup の動作確認**\n   - 別リポジトリのワークフローから呼び出し、`node_modules` が正常にインストールされること\n   - 2回目の実行でキャッシュが利用されること（`actions/cache` のキャッシュヒットログを確認）\n\n2. **playwright-setup の動作確認**\n   - `pnpm-setup` 実行後に `playwright-setup` を呼び出し、Playwright ブラウザがインストールされること\n   - 2回目の実行でキャッシュが利用され、`Install Playwright browsers` ステップがスキップされること（`if` 条件の動作確認）\n\n3. **slack-notify-success の動作確認**\n   - 有効な `channel-id` と `bot-oauth-token` を指定して実行し、Slack に成功通知が投稿されること\n   - `mention-user` を指定したとき、タイトルにメンションが含まれること\n   - `thread-ts` を指定したとき、スレッドへの返信になること\n\n4. **slack-notify-failure の動作確認**\n   - 有効な `webhook-url` を指定して実行し、Slack に失敗通知が投稿されること\n   - `mention-user` を指定したとき、タイトルにメンションが含まれること\n\n5. **README の確認**\n   - 各 Action の使用例 YAML スニペットが正しく表示されること\n   - 入力パラメータテーブルが読みやすいこと\n",
  "fileStats": {
    "size": 24348,
    "lines": 580,
    "lastModified": "2026-02-21T10:06:09.024Z"
  },
  "comments": []
}